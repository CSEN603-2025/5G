<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SCAD Appointments | GUC Internship</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-dark: #05445E;
      --primary-medium: #189AB4;
      --primary-light: #75E6DA;
      --primary-bg: #D4F1F4;
    }
    
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, var(--primary-bg) 0%, #E8F8FF 100%);
      color: var(--primary-dark);
      margin: 0;
      min-height: 100vh;
    }
    
    .header {
      background: var(--primary-dark);
      color: white;
      padding: 15px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .logo {
      font-size: 1.5rem;
      font-weight: bold;
    }
    
    .persistent-search {
      background: white;
      padding: 15px 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .search-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .search-container i {
      color: var(--primary-medium);
    }
    
    #globalSearch {
      flex: 1;
      padding: 12px 20px;
      border: 2px solid var(--primary-light);
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s;
    }
    
    #globalSearch:focus {
      border-color: var(--primary-medium);
      outline: none;
      box-shadow: 0 0 0 3px rgba(24, 154, 180, 0.2);
    }
    
    .search-btn {
      background: var(--primary-medium);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
    }
    
    .search-btn:hover {
      background: var(--primary-dark);
    }
    
    .container {
      max-width: 1200px;
      margin: 20px auto;
      padding: 0 20px;
    }
    
    .card {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
      margin-bottom: 2rem;
      border-top: 5px solid var(--primary-light);
    }
    
    .card h2 {
      color: var(--primary-dark);
      margin-bottom: 1.8rem;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .card h2 i {
      color: var(--primary-medium);
    }
    
    .btn-primary {
      background: linear-gradient(90deg, var(--primary-dark) 0%, var(--primary-medium) 100%);
      color: white;
      border: none;
      padding: 15px;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 4px 12px rgba(5, 68, 94, 0.2);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(5, 68, 94, 0.3);
    }
    
    .btn-secondary {
      background: var(--primary-light);
      color: var(--primary-dark);
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-secondary:hover {
      background: var(--primary-medium);
      color: white;
    }
    
    /* Appointments Page Specific Styles */
    .appointments-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }
    
    .appointment-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
      border-left: 4px solid var(--primary-medium);
      margin-bottom: 20px;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .appointment-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    
    .appointment-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
    }
    
    .appointment-status {
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .status-pending {
      background: #FFF3CD;
      color: #856404;
    }
    
    .status-approved {
      background: #D4EDDA;
      color: #155724;
    }
    
    .status-rejected {
      background: #F8D7DA;
      color: #721C24;
    }
    
    .status-completed {
      background: #E2E3E5;
      color: #383D41;
    }
    
    .status-cancelled {
      background: #f8f9fa;
      color: #6c757d;
      text-decoration: line-through;
    }
    
    /* Call Container Styles */
    .call-container {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 70%;
      max-width: 800px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(5, 68, 94, 0.3);
      z-index: 1000;
      display: none;
      transition: all 0.3s ease;
      border-top: 5px solid var(--primary-medium);
    }
    
    .call-container.fullscreen {
      width: 100%;
      height: 100%;
      max-width: none;
      border-radius: 0;
      top: 0;
      left: 0;
      transform: none;
    }
    
    .call-container.minimized {
      width: 300px;
      height: 60px;
      overflow: hidden;
      top: auto;
      bottom: 20px;
      left: 20px;
      transform: none;
    }
    
    .call-container.minimized .video-grid,
    .call-container.minimized .call-controls {
      display: none;
    }
    
    .call-container.minimized .call-header {
      border-radius: 8px;
      cursor: pointer;
    }
    
    .call-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: var(--primary-dark);
      color: white;
      cursor: move;
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
    }
    
    .call-header-buttons {
      display: flex;
      gap: 15px;
    }
    
    .call-header-btn {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 1rem;
      transition: transform 0.2s;
    }
    
    .call-header-btn:hover {
      transform: scale(1.1);
    }
    
    .video-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      padding: 15px;
      background: var(--primary-bg);
    }
    
    .video-container {
      background: #333;
      border-radius: 8px;
      aspect-ratio: 16/9;
      position: relative;
      overflow: hidden;
    }
    
    .video-label {
      position: absolute;
      bottom: 10px;
      left: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.9rem;
    }
    
    .call-controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      padding: 20px;
      background: white;
      border-bottom-left-radius: 12px;
      border-bottom-right-radius: 12px;
    }
    
    .call-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: none;
      background: var(--primary-light);
      color: var(--primary-dark);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      transition: all 0.3s;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .call-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    
    .call-btn.end-call {
      background: #E74C3C;
      color: white;
    }
    
    .call-btn.active {
      background: var(--primary-medium);
      color: white;
    }
    
    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(5, 68, 94, 0.7);
      z-index: 2000;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.3s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      border-top: 5px solid var(--primary-medium);
    }
    
    .close-modal {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 1.8rem;
      cursor: pointer;
      color: var(--primary-dark);
      transition: color 0.2s;
    }
    
    .close-modal:hover {
      color: var(--primary-medium);
    }
    
    .input-group {
      margin-bottom: 20px;
    }
    
    .input-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--primary-medium);
    }
    
    .input-group input,
    .input-group select,
    .input-group textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid var(--primary-light);
      border-radius: 8px;
      font-size: 1rem;
      background: rgba(212, 241, 244, 0.3);
      transition: all 0.3s;
    }
    
    .input-group input:focus,
    .input-group select:focus,
    .input-group textarea:focus {
      border-color: var(--primary-medium);
      outline: none;
      box-shadow: 0 0 0 3px rgba(24, 154, 180, 0.2);
    }
    
    .input-group textarea {
      resize: vertical;
      min-height: 100px;
    }
    
    /* Notes Modal */
    .notes-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(5, 68, 94, 0.7);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }
    
    .notes-content {
      background: white;
      padding: 25px;
      border-radius: 12px;
      width: 80%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      border-top: 5px solid var(--primary-medium);
    }
    
    .notes-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--primary-light);
    }
    
    .notes-header h3 {
      color: var(--primary-dark);
      margin: 0;
    }
    
    .close-notes {
      font-size: 1.8rem;
      cursor: pointer;
      color: var(--primary-dark);
      transition: color 0.2s;
    }
    
    .close-notes:hover {
      color: var(--primary-medium);
    }
    
    /* Toast Notifications */
    .toast-notification {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
      padding: 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      animation: slideIn 0.3s ease-out;
      z-index: 3000;
      border-left: 5px solid var(--primary-medium);
      max-width: 350px;
    }
    
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    .toast-notification i {
      font-size: 1.5rem;
      color: var(--primary-medium);
    }
    
    .toast-content {
      flex: 1;
    }
    
    .toast-content p {
      margin: 5px 0 0;
      color: #555;
    }

    /* Call Notification Styles */
    .call-notification {
      position: absolute;
      top: 10px;
      left: 0;
      right: 0;
      z-index: 10;
      animation: fadeIn 0.5s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* No results message */
    .no-results {
      grid-column: 1 / -1;
      text-align: center;
      padding: 40px;
      color: #666;
    }
    
    .no-results i {
      font-size: 3rem;
      color: var(--primary-light);
      margin-bottom: 20px;
    }
    
    /* Responsive */
    @media (max-width: 992px) {
      .appointments-container {
        grid-template-columns: 1fr;
      }
      
      .call-container {
        width: 90%;
      }
      
      .video-grid {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 768px) {
      .search-container {
        flex-direction: column;
      }
      
      #globalSearch {
        width: 100%;
      }
      
      .search-btn {
        width: 100%;
      }
      
      .call-container {
        width: 95%;
      }
      
      .call-controls {
        gap: 10px;
      }
      
      .call-btn {
        width: 50px;
        height: 50px;
        font-size: 1.1rem;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="logo">GUC SCAD PORTAL</div>
    <a href="SCAD.html" class="btn-secondary mt-2" style="margin-top: 1rem; margin-left: 5rem; display: inline-block; text-decoration: none; padding: 0.5rem 1rem; border-radius: 6px;">
  <i class="fas fa-arrow-left"></i>
  Back
</a>
    </div>
  </header>

  <!-- Search Bar -->
  <div class="persistent-search">
    <div class="search-container">
      <i class="fas fa-search"></i>
      <input type="text" id="globalSearch" placeholder="Search student appointments...">
      <button id="searchButton" class="search-btn">
        <i class="fas fa-search"></i> Search
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <main class="container">
    <div class="card">
      <h2><i class="fas fa-video"></i> Student Video Call Appointments</h2>
      
      <div class="appointments-container" id="appointmentsContainer">
        <!-- Appointment cards will be dynamically inserted here -->
      </div>
    </div>
  </main>

  <!-- Call Interface -->
  <div class="call-container" id="callContainer">
    <div class="call-header" id="callHeader">
      <div>
        <h3 id="callTitle">Career Guidance Session</h3>
        <p id="callDuration">00:00:00</p>
      </div>
      <div class="call-header-buttons">
        <button class="call-header-btn" id="minimizeCall">
          <i class="fas fa-window-minimize"></i>
        </button>
        <button class="call-header-btn" id="maximizeCall">
          <i class="fas fa-expand"></i>
        </button>
        <button class="call-header-btn" id="closeCall">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
    
    <div class="video-grid">
      <div class="video-container">
        <video id="remoteVideo" autoplay playsinline></video>
        <div class="video-label" id="remoteVideoLabel">Student</div>
      </div>
      <div class="video-container">
        <video id="localVideo" autoplay playsinline muted></video>
        <div class="video-label">You (SCAD Advisor)</div>
      </div>
    </div>
    
    <div class="call-controls">
      <button class="call-btn" id="toggleMic">
        <i class="fas fa-microphone"></i>
      </button>
      <button class="call-btn" id="toggleVideo">
        <i class="fas fa-video"></i>
      </button>
      <button class="call-btn" id="shareScreen">
        <i class="fas fa-desktop"></i>
      </button>
      <button class="call-btn end-call" id="endCall">
        <i class="fas fa-phone-slash"></i>
      </button>
    </div>
  </div>

  <!-- Notes Modal -->
  <div class="notes-modal" id="notesModal">
    <div class="notes-content">
      <div class="notes-header">
        <h3>Appointment Notes</h3>
        <span class="close-notes" style="cursor: pointer; font-size: 24px;">&times;</span>
      </div>
      <div id="notesContent">
        <!-- Notes will be dynamically inserted here -->
      </div>
      <div class="input-group" style="margin-top: 20px;">
        <label for="advisorNotes">Add Notes</label>
        <textarea id="advisorNotes" rows="4" placeholder="Enter notes about this session..."></textarea>
        <button class="btn-primary" style="margin-top: 10px; width: 100%;" id="saveNotesBtn">
          <i class="fas fa-save"></i> Save Notes
        </button>
      </div>
    </div>
  </div>

  <script>
    // Enhanced dummy data for student appointments with more searchable fields
    const dummyAppointments = [
        {
            id: 1,
            studentId: "58-25067",
            studentName: "Ahmed Mohamed",
            title: "Career Guidance Session",
            status: "approved",
            date: "May 20, 2025",
            rawDate: "2025-05-20",
            time: "2:00 PM - 2:30 PM",
            rawTime: "14:00",
            purpose: "Discuss internship options and career paths",
            notes: "",
            online: true,
            major: "Computer Science",
            gpa: "3.4",
            internshipStatus: "Looking for summer internship",
            tags: ["career", "internship", "guidance"]
        },
        {
            id: 2,
            studentId: "58-25123",
            studentName: "Mariam Ali",
            title: "CV Review",
            status: "pending",
            date: "May 22, 2025",
            rawDate: "2025-05-22",
            time: "11:00 AM - 11:30 AM",
            rawTime: "11:00",
            purpose: "Need help improving CV for internship applications",
            notes: "",
            online: false,
            major: "Business Administration",
            gpa: "3.7",
            internshipStatus: "Applied to 5 companies",
            tags: ["cv", "resume", "applications"]
        },
        {
            id: 3,
            studentId: "58-25089",
            studentName: "Omar Khaled",
            title: "Internship Report Review",
            status: "approved",
            date: "May 18, 2025",
            rawDate: "2025-05-18",
            time: "3:00 PM - 3:45 PM",
            rawTime: "15:00",
            purpose: "Clarify questions about internship report requirements",
            notes: "",
            online: true,
            major: "Engineering",
            gpa: "3.2",
            internshipStatus: "Currently interning at Siemens",
            tags: ["report", "internship", "requirements"]
        },
        {
            id: 4,
            studentId: "58-25145",
            studentName: "Yasmin Hassan",
            title: "Career Change Consultation",
            status: "completed",
            date: "May 15, 2025",
            rawDate: "2025-05-15",
            time: "10:00 AM - 10:45 AM",
            rawTime: "10:00",
            purpose: "Discuss switching from Architecture to UX Design",
            notes: "Discussed potential career paths and recommended online courses. Student should explore GUC's UX elective next semester.",
            online: false,
            major: "Architecture",
            gpa: "3.5",
            internshipStatus: "Not currently looking",
            tags: ["career", "change", "consultation"]
        },
        {
            id: 5,
            studentId: "58-25012",
            studentName: "Karim Samir",
            title: "Interview Preparation",
            status: "approved",
            date: "May 25, 2025",
            rawDate: "2025-05-25",
            time: "1:00 PM - 1:30 PM",
            rawTime: "13:00",
            purpose: "Practice for upcoming internship interview at Google",
            notes: "",
            online: true,
            major: "Computer Science",
            gpa: "3.8",
            internshipStatus: "Interview scheduled for next week",
            tags: ["interview", "preparation", "practice"]
        }
    ];

    // Status class mapping
    const statusClasses = {
        pending: "status-pending",
        approved: "status-approved",
        rejected: "status-rejected",
        completed: "status-completed",
        cancelled: "status-cancelled"
    };

    document.addEventListener('DOMContentLoaded', function() {
        // Initialize the page with dummy data
        renderAppointments(dummyAppointments);
        
        // Search Elements
        const globalSearch = document.getElementById('globalSearch');
        const searchButton = document.getElementById('searchButton');
        
        // Call Elements
        const callContainer = document.getElementById('callContainer');
        const callHeader = document.getElementById('callHeader');
        const toggleMic = document.getElementById('toggleMic');
        const toggleVideo = document.getElementById('toggleVideo');
        const shareScreen = document.getElementById('shareScreen');
        const endCall = document.getElementById('endCall');
        const minimizeBtn = document.getElementById('minimizeCall');
        const maximizeBtn = document.getElementById('maximizeCall');
        const closeBtn = document.getElementById('closeCall');
        const remoteVideoLabel = document.getElementById('remoteVideoLabel');
        
        // Appointment Elements
        const notesModal = document.getElementById('notesModal');
        const closeNotes = document.querySelector('.close-notes');
        const saveNotesBtn = document.getElementById('saveNotesBtn');
        const advisorNotes = document.getElementById('advisorNotes');
        
        // State variables
        let callTimerInterval;
        let isDragging = false;
        let offsetX, offsetY;
        let isCallActive = false;
        let currentAppointmentId = null;
        let currentStudentName = null;
        let currentStudentId = null;
        let remoteParticipantConnected = false;
        let remoteParticipantLeftTimeout = null;
        let ringtone = null;
        let incomingCallTimeout = null;
        let incomingCallElement = null;

        // Search functionality
        function searchAppointments(searchTerm) {
            if (!searchTerm || searchTerm.trim() === '') {
                renderAppointments(dummyAppointments);
                return;
            }
            
            const term = searchTerm.toLowerCase();
            
            const results = dummyAppointments.filter(appointment => {
                // Search in multiple fields
                return (
                    appointment.studentName.toLowerCase().includes(term) ||
                    appointment.studentId.toLowerCase().includes(term) ||
                    appointment.title.toLowerCase().includes(term) ||
                    appointment.purpose.toLowerCase().includes(term) ||
                    (appointment.notes && appointment.notes.toLowerCase().includes(term)) ||
                    appointment.major.toLowerCase().includes(term) ||
                    appointment.internshipStatus.toLowerCase().includes(term) ||
                    appointment.tags.some(tag => tag.toLowerCase().includes(term)) ||
                    appointment.status.toLowerCase().includes(term) ||
                    appointment.date.toLowerCase().includes(term) ||
                    appointment.time.toLowerCase().includes(term));
            });
            
            renderAppointments(results);
        }
        
        // Event listeners for search
        searchButton.addEventListener('click', function() {
            searchAppointments(globalSearch.value);
        });
        
        globalSearch.addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                searchAppointments(globalSearch.value);
            }
        });
        
        // Global search input event for real-time search (optional)
        globalSearch.addEventListener('input', function() {
            searchAppointments(globalSearch.value);
        });

        // Render appointments with optional filtering
        function renderAppointments(appointments = dummyAppointments) {
            const container = document.getElementById('appointmentsContainer');
            container.innerHTML = '';
            
            if (appointments.length === 0) {
                container.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search"></i>
                        <h3>No appointments found</h3>
                        <p>Try adjusting your search criteria</p>
                    </div>
                `;
                return;
            }
            
            appointments.forEach(appointment => {
                const card = document.createElement('div');
                card.className = 'appointment-card';
                card.dataset.id = appointment.id;
                
                const statusClass = statusClasses[appointment.status] || '';
                const onlineStatus = appointment.online ? 
                    `<div class="online-status" style="margin-top: 10px;">
                        <i class="fas fa-circle" style="color: #2ECC71;"></i> 
                        <span>${appointment.studentName} is currently online</span>
                    </div>` : '';
                
                const actions = getAppointmentActions(appointment);
                
                card.innerHTML = `
                    <div class="appointment-header">
                        <h3>${appointment.title} with ${appointment.studentName}</h3>
                        <span class="appointment-status ${statusClass}">${appointment.status.charAt(0).toUpperCase() + appointment.status.slice(1)}</span>
                    </div>
                    <p><strong>Student ID:</strong> ${appointment.studentId}</p>
                    <p><strong>Major:</strong> ${appointment.major} | GPA: ${appointment.gpa}</p>
                    <p><strong>Internship Status:</strong> ${appointment.internshipStatus}</p>
                    <p><strong>Date:</strong> ${appointment.date} | ${appointment.time}</p>
                    <p><strong>Purpose:</strong> ${appointment.purpose}</p>
                    ${appointment.notes ? `<p><strong>Previous Notes:</strong> ${appointment.notes}</p>` : ''}
                    <div class="appointment-actions" style="margin-top: 15px;">
                        ${actions}
                    </div>
                    ${onlineStatus}
                `;
                
                container.appendChild(card);
            });
            
            // Re-attach event listeners after rendering
            attachEventListeners();
        }

        // Get appropriate action buttons based on appointment status
        function getAppointmentActions(appointment) {
            switch(appointment.status) {
                case 'approved':
                    return `
                        <button class="btn-secondary start-call-btn" data-appointment="${appointment.id}">
                            <i class="fas fa-phone"></i> Start Call
                        </button>
                        <button class="btn-secondary view-notes-btn" style="margin-left: 10px;">
                            <i class="fas fa-file-alt"></i> View/Add Notes
                        </button>
                    `;
                case 'pending':
                    return `
                        <button class="btn-secondary approve-btn" data-appointment="${appointment.id}">
                            <i class="fas fa-check"></i> Approve
                        </button>
                        <button class="btn-secondary reject-btn" style="margin-left: 10px;" data-appointment="${appointment.id}">
                            <i class="fas fa-times"></i> Reject
                        </button>
                    `;
                case 'completed':
                    return `
                        <button class="btn-secondary view-notes-btn">
                            <i class="fas fa-file-alt"></i> View Notes
                        </button>
                    `;
                case 'rejected':
                    return `
                        <button class="btn-secondary reschedule-btn">
                            <i class="fas fa-calendar-plus"></i> Reschedule
                        </button>
                    `;
                case 'cancelled':
                    return `
                        <button class="btn-secondary reschedule-btn">
                            <i class="fas fa-calendar-plus"></i> Reschedule
                        </button>
                    `;
                default:
                    return '';
            }
        }

        // Attach event listeners to dynamically created elements
        function attachEventListeners() {
            // Start call buttons
            document.querySelectorAll('.start-call-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const appointmentId = parseInt(this.getAttribute('data-appointment'));
                    startCall(appointmentId);
                });
            });
            
            // Approve buttons
            document.querySelectorAll('.approve-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const appointmentId = parseInt(this.getAttribute('data-appointment'));
                    approveAppointment(appointmentId);
                });
            });
            
            // Reject buttons
            document.querySelectorAll('.reject-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const appointmentId = parseInt(this.getAttribute('data-appointment'));
                    rejectAppointment(appointmentId);
                });
            });
            
            // View notes buttons
            document.querySelectorAll('.view-notes-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const card = this.closest('.appointment-card');
                    const appointmentId = parseInt(card.dataset.id);
                    viewNotes(appointmentId);
                });
            });
            
            // Reschedule buttons
            document.querySelectorAll('.reschedule-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const card = this.closest('.appointment-card');
                    const appointmentId = parseInt(card.dataset.id);
                    rescheduleAppointment(appointmentId);
                });
            });
        }

        // Make call window draggable
        callHeader.addEventListener('mousedown', function(e) {
            if (callContainer.classList.contains('fullscreen') || callContainer.classList.contains('minimized')) return;
            
            isDragging = true;
            offsetX = e.clientX - callContainer.getBoundingClientRect().left;
            offsetY = e.clientY - callContainer.getBoundingClientRect().top;
            callContainer.style.cursor = 'grabbing';
        });
        
        document.addEventListener('mousemove', function(e) {
            if (!isDragging) return;
            
            callContainer.style.left = (e.clientX - offsetX) + 'px';
            callContainer.style.top = (e.clientY - offsetY) + 'px';
            callContainer.style.transform = 'none';
        });
        
        document.addEventListener('mouseup', function() {
            isDragging = false;
            callContainer.style.cursor = '';
        });
        
        // Minimize/Maximize/Close functionality
        minimizeBtn.addEventListener('click', function() {
            callContainer.classList.toggle('minimized');
            if (callContainer.classList.contains('minimized')) {
                minimizeBtn.innerHTML = '<i class="fas fa-window-restore"></i>';
            } else {
                minimizeBtn.innerHTML = '<i class="fas fa-window-minimize"></i>';
            }
        });
        
        maximizeBtn.addEventListener('click', function() {
            callContainer.classList.toggle('fullscreen');
            if (callContainer.classList.contains('fullscreen')) {
                maximizeBtn.innerHTML = '<i class="fas fa-compress"></i>';
            } else {
                maximizeBtn.innerHTML = '<i class="fas fa-expand"></i>';
            }
        });
        
        closeBtn.addEventListener('click', function() {
            stopCall();
        });
        
        // End call button
        endCall.addEventListener('click', function() {
            stopCall();
        });
        
        // Close notes modal
        closeNotes.addEventListener('click', function() {
            notesModal.style.display = 'none';
        });
        
        // Save notes button
        saveNotesBtn.addEventListener('click', function() {
            const appointment = dummyAppointments.find(a => a.id === currentAppointmentId);
            if (appointment) {
                appointment.notes = advisorNotes.value;
                showNotification('Notes Saved', `Notes for ${currentStudentName} have been saved`);
                renderAppointments();
                notesModal.style.display = 'none';
                advisorNotes.value = '';
            }
        });
        
        // Appointment actions
        function approveAppointment(appointmentId) {
            const appointment = dummyAppointments.find(a => a.id === appointmentId);
            if (appointment) {
                appointment.status = "approved";
                renderAppointments();
                showNotification('Appointment Approved', `Appointment with ${appointment.studentName} has been approved`);
            }
        }
        
        function rejectAppointment(appointmentId) {
            const appointment = dummyAppointments.find(a => a.id === appointmentId);
            if (appointment) {
                const reason = prompt("Please enter reason for rejection:");
                if (reason !== null) {
                    appointment.status = "rejected";
                    appointment.notes = reason;
                    renderAppointments();
                    showNotification('Appointment Rejected', `Appointment with ${appointment.studentName} has been rejected`);
                }
            }
        }
        
        function viewNotes(appointmentId) {
            const appointment = dummyAppointments.find(a => a.id === appointmentId);
            if (appointment) {
                currentAppointmentId = appointmentId;
                currentStudentName = appointment.studentName;
                currentStudentId = appointment.studentId;
                
                document.getElementById('notesContent').innerHTML = `
                    <h4>${appointment.title}</h4>
                    <p><strong>Student:</strong> ${appointment.studentName} (${appointment.studentId})</p>
                    <p><strong>Date:</strong> ${appointment.date} | ${appointment.time}</p>
                    <p><strong>Purpose:</strong> ${appointment.purpose}</p>
                    <hr>
                    <h5>Current Notes:</h5>
                    <p>${appointment.notes || 'No notes available for this appointment.'}</p>
                `;
                
                advisorNotes.value = appointment.notes || '';
                notesModal.style.display = 'flex';
            }
        }
        
        function rescheduleAppointment(appointmentId) {
            const appointment = dummyAppointments.find(a => a.id === appointmentId);
            if (appointment) {
                const newDate = prompt("Enter new date (e.g., May 30, 2025):", appointment.date);
                const newTime = prompt("Enter new time (e.g., 2:00 PM - 2:30 PM):", appointment.time);
                
                if (newDate && newTime) {
                    appointment.date = newDate;
                    appointment.time = newTime;
                    appointment.status = "approved";
                    renderAppointments();
                    showNotification('Appointment Rescheduled', `Appointment with ${appointment.studentName} has been rescheduled`);
                }
            }
        }
        
        // Call control functions
        function startCall(appointmentId) {
            const appointment = dummyAppointments.find(a => a.id === appointmentId);
            if (!appointment) return;
            
            isCallActive = true;
            currentAppointmentId = appointmentId;
            currentStudentName = appointment.studentName;
            currentStudentId = appointment.studentId;
            remoteParticipantConnected = true;
            callContainer.style.display = 'block';
            document.getElementById('callTitle').textContent = appointment.title;
            remoteVideoLabel.textContent = `${appointment.studentName} (${appointment.studentId})`;
            
            // Reset any previous states
            callContainer.classList.remove('fullscreen', 'minimized');
            maximizeBtn.innerHTML = '<i class="fas fa-expand"></i>';
            minimizeBtn.innerHTML = '<i class="fas fa-window-minimize"></i>';
            
            // Center the call container
            callContainer.style.left = '50%';
            callContainer.style.top = '50%';
            callContainer.style.transform = 'translate(-50%, -50%)';
            
            // Reset call controls
            toggleMic.classList.remove('active');
            toggleMic.querySelector('i').className = 'fas fa-microphone';
            toggleVideo.classList.remove('active');
            toggleVideo.querySelector('i').className = 'fas fa-video';
            shareScreen.classList.remove('active');
            
            // Enable all controls
            toggleMic.disabled = false;
            toggleVideo.disabled = false;
            shareScreen.disabled = false;
            
            // Simulate call duration timer
            let seconds = 0;
            updateCallDuration(seconds);
            callTimerInterval = setInterval(() => {
                seconds++;
                updateCallDuration(seconds);
            }, 1000);
            
            // Simulate video streams
            simulateVideoStreams();
            
            // Simulate remote participant leaving after random time (for demo purposes)
            const leaveTime = Math.floor(Math.random() * 15000) + 5000; // Between 5-20 seconds
            if (remoteParticipantLeftTimeout) {
                clearTimeout(remoteParticipantLeftTimeout);
            }
            remoteParticipantLeftTimeout = setTimeout(() => {
                remoteParticipantLeft();
            }, leaveTime);
        }
        
        function updateCallDuration(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            document.getElementById('callDuration').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        function simulateVideoStreams() {
            // In a real app, you would connect actual video streams here
            const remoteVideo = document.getElementById('remoteVideo');
            const localVideo = document.getElementById('localVideo');
            
            remoteVideo.innerHTML = '<div style="color:white;text-align:center;padding-top:50px;">Student Video Stream</div>';
            localVideo.innerHTML = '<div style="color:white;text-align:center;padding-top:50px;">Your Video (SCAD Advisor)</div>';
        }
        
        function remoteParticipantLeft() {
            if (!isCallActive) return;
            
            remoteParticipantConnected = false;
            
            // Update the remote video display
            const remoteVideo = document.getElementById('remoteVideo');
            remoteVideo.innerHTML = `
                <div style="color:white;text-align:center;padding-top:50px;background:#333;height:100%;">
                    <div style="padding-top:60px;font-size:1.5rem;">
                        <i class="fas fa-user-slash"></i>
                    </div>
                    <p>${currentStudentName} has left the call</p>
                </div>
            `;
            
            // Show persistent notification in the call window
            const callNotification = document.createElement('div');
            callNotification.className = 'call-notification';
            callNotification.innerHTML = `
                <div style="background: rgba(255,0,0,0.7); color: white; padding: 10px; 
                    border-radius: 5px; margin: 10px; text-align: center;">
                    <i class="fas fa-exclamation-triangle"></i> 
                    ${currentStudentName} has left the call
                </div>
            `;
            document.querySelector('.video-grid').prepend(callNotification);
            
            // Show toast notification
            showNotification('Call Ended', `${currentStudentName} has left the call`);
            
            // Disable call controls (except end call)
            toggleMic.disabled = true;
            toggleVideo.disabled = true;
            shareScreen.disabled = true;
            
            // Change call title
            document.getElementById('callTitle').textContent = 'Call Ended - Student Left';
            
            // Auto-end call after 10 seconds
            setTimeout(stopCall, 10000);
        }
        
        function stopCall() {
            if (!isCallActive) return; // Don't do anything if no call is active
            
            // Clear all intervals and timeouts
            clearInterval(callTimerInterval);
            if (remoteParticipantLeftTimeout) {
                clearTimeout(remoteParticipantLeftTimeout);
                remoteParticipantLeftTimeout = null;
            }
            
            // Reset call UI
            document.getElementById('callDuration').textContent = '00:00:00';
            callContainer.style.display = 'none';
            callContainer.classList.remove('fullscreen', 'minimized');
            
            // Reset call controls
            toggleMic.classList.remove('active');
            toggleMic.querySelector('i').className = 'fas fa-microphone';
            toggleVideo.classList.remove('active');
            toggleVideo.querySelector('i').className = 'fas fa-video';
            shareScreen.classList.remove('active');
            
            // Reset state
            isCallActive = false;
            
            // Mark appointment as completed if it was long enough
            if (currentAppointmentId) {
                const durationText = document.getElementById('callDuration').textContent;
                const [hours, minutes] = durationText.split(':').map(Number);
                
                if (hours > 0 || minutes > 1) {
                    const appointment = dummyAppointments.find(a => a.id === currentAppointmentId);
                    if (appointment && appointment.status === 'approved') {
                        appointment.status = 'completed';
                        renderAppointments();
                    }
                }
                currentAppointmentId = null;
                currentStudentName = null;
                currentStudentId = null;
            }
            
            showNotification('Call ended', 'Your video call with the student has concluded.');
        }
        
        // Toggle mic/video
        toggleMic.addEventListener('click', function() {
            this.classList.toggle('active');
            const icon = this.querySelector('i');
            if (this.classList.contains('active')) {
                icon.className = 'fas fa-microphone-slash';
                showNotification('Microphone', 'Your microphone has been muted');
            } else {
                icon.className = 'fas fa-microphone';
                showNotification('Microphone', 'Your microphone is now active');
            }
        });
        
        toggleVideo.addEventListener('click', function() {
            this.classList.toggle('active');
            const icon = this.querySelector('i');
            if (this.classList.contains('active')) {
                icon.className = 'fas fa-video-slash';
                document.getElementById('localVideo').innerHTML = '<div style="color:white;text-align:center;padding-top:50px;">Video Off</div>';
                showNotification('Video', 'Your video has been disabled');
            } else {
                icon.className = 'fas fa-video';
                document.getElementById('localVideo').innerHTML = '<div style="color:white;text-align:center;padding-top:50px;">Your Video (SCAD Advisor)</div>';
                showNotification('Video', 'Your video is now active');
            }
        });
        
        // Screen sharing
        shareScreen.addEventListener('click', function() {
            this.classList.toggle('active');
            if (this.classList.contains('active')) {
                document.getElementById('localVideo').innerHTML = '<div style="color:white;text-align:center;padding-top:50px;">Screen Sharing</div>';
                showNotification('Screen Sharing', 'You are now sharing your screen');
            } else {
                document.getElementById('localVideo').innerHTML = '<div style="color:white;text-align:center;padding-top:50px;">Your Video (SCAD Advisor)</div>';
                showNotification('Screen Sharing', 'Screen sharing has stopped');
            }
        });
        
        function cleanupIncomingCall() {
            if (ringtone) {
                ringtone.pause();
                ringtone.currentTime = 0;
                ringtone = null;
            }
            if (navigator.vibrate) navigator.vibrate(0);
            if (incomingCallTimeout) {
                clearTimeout(incomingCallTimeout);
                incomingCallTimeout = null;
            }
            if (incomingCallElement && document.body.contains(incomingCallElement)) {
                incomingCallElement.remove();
                incomingCallElement = null;
            }
        }

        // Simulate incoming call notification
        function showIncomingCallNotification() {
            if (!isCallActive && dummyAppointments.some(a => a.online)) {
                const onlineAppointment = dummyAppointments.find(a => a.online);
                const studentName = onlineAppointment.studentName;
                const studentId = onlineAppointment.studentId;
                
                // Clean up any existing call notification first
                cleanupIncomingCall();
                
                incomingCallElement = document.createElement('div');
                incomingCallElement.className = 'toast-notification incoming-call-notification';
                incomingCallElement.innerHTML = `
                    <div class="toast-content">
                        <i class="fas fa-phone" style="color: var(--primary-medium);"></i>
                        <div>
                            <p><strong>Incoming Call</strong></p>
                            <p>${studentName} (${studentId}) is calling</p>
                        </div>
                        <div style="display: flex; gap: 10px; margin-left: 15px;">
                            <button class="btn-primary accept-call-btn" style="padding: 5px 10px; font-size: 0.8rem;">
                                <i class="fas fa-phone"></i> Accept
                            </button>
                            <button class="btn-secondary decline-call-btn" style="padding: 5px 10px; font-size: 0.8rem;">
                                <i class="fas fa-phone-slash"></i> Decline
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(incomingCallElement);
                
                // Add vibration effect for incoming call
                if (navigator.vibrate) {
                    navigator.vibrate([200, 100, 200, 100, 200]);
                }
                
                // Play ringtone sound
                ringtone = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-classic-phone-ring-449.mp3');
                ringtone.loop = true;
                ringtone.play().catch(e => console.log('Audio play failed:', e));
                
                // Handle accept button click
                incomingCallElement.querySelector('.accept-call-btn').addEventListener('click', function() {
                    cleanupIncomingCall();
                    startCall(onlineAppointment.id);
                });
                
                // Handle decline button click
                incomingCallElement.querySelector('.decline-call-btn').addEventListener('click', function() {
                    cleanupIncomingCall();
                    showNotification('Call Declined', `You declined the call from ${studentName}`);
                });
                
                // Auto-dismiss after 30 seconds if not answered
                incomingCallTimeout = setTimeout(() => {
                    cleanupIncomingCall();
                    showNotification('Missed Call', `Missed call from ${studentName}`);
                }, 30000);
            }
        }

        // Call this function to simulate an incoming call
        setTimeout(showIncomingCallNotification, 10000);

        // Notification function
        function showNotification(title, message) {
            const notification = document.createElement('div');
            notification.className = 'toast-notification';
            notification.innerHTML = `
                <div class="toast-content">
                    <i class="fas fa-bell"></i>
                    <div>
                        <p><strong>${title}</strong></p>
                        <p>${message}</p>
                    </div>
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }
        
        // Close modals when clicking outside
        window.addEventListener('click', function(e) {
            if (e.target === notesModal) {
                notesModal.style.display = 'none';
            }
        });
    });
  </script>
</body>
</html>